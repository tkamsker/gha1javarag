What I changed
run_iteration.sh
Added flags: --output-dir, --rotate-output, --force-step1, --no-step1, --repeat-step2, --step3=pgm|crewai|both, --step3-parallel/--step3-sequential, --step3-max-workers, --step3-incremental, --step3-force, --crewai-no-verbose, --pgm-pattern-based.
Stable OUTPUT_DIR selection without rewriting .env, unless missing or explicitly rotated.
Step1 guarded with marker detection at $OUTPUT_DIR/.step1_complete and optional force/skip.
Step2 only runs if missing or --repeat-step2.
Step3 orchestrates pgm/crewai/both and creates requirements/comparison/index.md.
step1.sh
Ensures OUTPUT_DIR exists but doesn’t rotate existing values.
After successful analyze, writes $OUTPUT_DIR/.step1_complete with timestamp and source_dir.
src/prompts.py
Added ini/properties/config prompt support.
Existing prompts for java/jsp/html/xml/sql/js/css preserved.
src/cli.py (analyze)
Keeps per-file LLM enrichment.
Adds normalized meta section per file:
kind, provides_endpoints, uses_tables, queries, config_keys, ui_components, navigation.
Stored under file_record.meta for later refactoring.
How to use
First run with persistence and both step3 modes:
./docker-weaviate.sh
./run_iteration.sh --rotate-output --step3=both
Iterate without re-indexing:
./run_iteration.sh --no-step1 --repeat-step2 --step3=both
Force re-index on changes:
./run_iteration.sh --force-step1 --repeat-step2 --step3=pgm
Custom output:
./run_iteration.sh --output-dir ./output_exp --step3=crewai --crewai-no-verbose
The comparison index is at: $OUTPUT_DIR/requirements/comparison/index.md
All tasks from the plan are complete.

## -- 1158


ä Test run 

test_setup.sh
source venv/bin/activate && pytest -q