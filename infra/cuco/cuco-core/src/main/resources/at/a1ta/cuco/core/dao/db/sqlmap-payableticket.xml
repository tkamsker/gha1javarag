<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
  PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
  "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<!-- @author: rene.weidinger@telekom.at -->
<sqlMap namespace="PayableTicket">
	<typeAlias alias="payableticket" type="at.a1ta.cuco.core.shared.dto.PayableTicket"/>
	
	<resultMap id="payableticket-result" class="payableticket">
		<result property="id" column="gula_id" />
		<result property="customerId" column="kunde_id" />
		<result property="onkz" column="vorwahl" />
		<result property="number" column="rufnummer" />
		<result property="service" column="this2dienstleistung" select="Service.get"/>
		<result property="comment" column="kommentartext" />
		<result property="agent" column="user_id" select="User.getBiteUserById" />
		<result property="exportedDate" column="exportedat" />
		<result property="clearingAccountNumber" column="customeraccountid" />
		<result property="createDate" column="createdat" />
		<result property="costs" column="kosten" />
	</resultMap>

	<select id="getTicketsForParties" resultMap="payableticket-result" parameterClass="java.util.Map">
		SELECT *
		FROM cuco_gula
		<dynamic prepend="WHERE">
		  	<isNotNull prepend="AND" property="parties">
		  		kunde_id IN <iterate open="(" close=")" conjunction="," property="parties">#parties[].id#</iterate>
		  	</isNotNull>
		</dynamic>
	</select>
	
	<insert id="insert" parameterClass="payableticket">
		<selectKey resultClass="long" keyProperty="id">SELECT seq_cuco_gula.nextval AS id FROM dual</selectKey>
		INSERT INTO cuco_gula(gula_id, kunde_id, vorwahl, rufnummer, this2dienstleistung,kommentartext,user_id,exportedat,customeraccountid,createdat,kosten)
		VALUES (#id#, #customerId#,#onkz#,#number#,#service.id#,#comment#,#agent.id#,#exportedDate#,#clearingAccountNumber#,systimestamp,#costs#)
	</insert>
</sqlMap>