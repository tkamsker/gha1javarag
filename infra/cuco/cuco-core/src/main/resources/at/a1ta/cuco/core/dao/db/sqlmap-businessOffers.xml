<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
  PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
  "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<!-- @author: christoph.strobl@telekom.at -->
<sqlMap namespace="BusinessOffer">
	<cacheModel id="businessoffer-cache" type="ehcacheProvider" readOnly="true" serialize="false">
		<flushInterval hours="3" />
		<property name="cache-size" value="100" />
	</cacheModel>

	<resultMap id="bussinessOffer-result" class="at.a1ta.cuco.core.shared.dto.BusinessOffer">
		<result property="customerId" column="kunde_id" />
		<result property="productDescription" column="produkt_bes" />
	</resultMap>

	<sql id="attributes_v_business_angebot">
		kunde_id, produkt_bes
	</sql>

	<select id="GetBusinessOffers4Customer" resultMap="bussinessOffer-result" parameterClass="java.lang.Long" cacheModel="businessoffer-cache">
		SELECT <include refid="attributes_v_business_angebot" />
		  FROM v_business_angebot
		 WHERE kunde_id = #customer_id#
	  ORDER BY produkt_bes
	</select>

	<select id="CountBusinessOffers4Customer" resultClass="java.lang.Integer" parameterClass="java.lang.Long" cacheModel="businessoffer-cache">
		SELECT count(produkt_bes)
		  FROM v_business_angebot
		 WHERE kunde_id = #customer_id#
	</select>
</sqlMap>