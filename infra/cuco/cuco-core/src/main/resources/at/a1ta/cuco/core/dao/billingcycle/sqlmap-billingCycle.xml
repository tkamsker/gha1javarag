<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
  PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
  "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="BillingCycle">

	<typeAlias alias="cycle" type="at.a1ta.cuco.core.shared.dto.BillingCycle"/>
	<typeAlias alias="entry" type="at.a1ta.cuco.core.shared.dto.BillingCycleEntry"/>

	<resultMap id="billingCycle-result" class="cycle" groupBy="billingDate">
		<result property="billingDate" column="Rechnung" />
		<result property="entries" column="Rechnung" resultMap="BillingCycle.entry-result"/>
	</resultMap>
	
	<resultMap class="entry" id="entry-result">
		<result property="id" column="id" />
		<result property="vBlock" column="VBlock" />
		<result property="column" column="Spalte" />
		<result property="step" column="Schritt" />
		<result property="from" column="von" />
		<result property="to" column="bis" />
		<result property="hr" column="HR" />
	</resultMap>

	<select id="getVBlock" resultMap="billingCycle-result" parameterClass="java.lang.String">
		SELECT     
			id, CONVERT(datetime, Rechnung) AS rechnung, VBlock, Spalte, Schritt, von, bis, HR
		FROM         dbo.Arbeitsplan_begin_1
		WHERE     
			(VBlock = #vblock#) 
		AND 
			(CONVERT(datetime, Rechnung) &gt; GETDATE()) 
		AND 
			(CONVERT(datetime, Rechnung) &lt; GETDATE() + 67)
		ORDER BY CONVERT(datetime, Rechnung)
	</select>

</sqlMap>