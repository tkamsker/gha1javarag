<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
  PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
  "http://ibatis.apache.org/dtd/sql-map-2.dtd">
  
<sqlMap namespace="ImportUserShopAssignment">

  <typeAlias alias="logline" type="at.a1ta.cuco.core.shared.dto.UserShopAssignmentLogLine" />
  <typeAlias alias="assignment" type="at.a1ta.cuco.core.shared.dto.UserShopAssignment" />

  <resultMap id="loglinedata" class="logline">
    <result property="userName" column="username" />
    <result property="logText" column="logtext" />
  </resultMap>

  <resultMap id="assignmentdata" class="assignment">
    <result property="userName" column="username" />
    <result property="shopID" column="shopid" />
  </resultMap>
  
  <select id="getUserIDs4Assignments" resultClass="java.lang.String">
    SELECT DISTINCT upper(login) FROM BITE_USER
  </select>
  
  <select id="getAssignedShopIDs" resultClass="java.lang.String">
    SELECT DISTINCT shopid FROM CUCO_USERSHOPASSIGNMENT
  </select>
  
  <select id="getLogEntries" resultMap="loglinedata">
    SELECT username, logtext FROM CUCO_USERSHOPASSIGNMENTLOGS
  </select>
  
  <select id="getLogEntriesCount" resultClass="java.lang.Integer">
    SELECT COUNT(*) FROM CUCO_USERSHOPASSIGNMENTLOGS
  </select>
  
  <insert id="insertLogEntry" parameterClass="logline">
    INSERT INTO CUCO_USERSHOPASSIGNMENTLOGS( username, logtext ) VALUES ( #userName#, #logText# )
  </insert>
  
  <select id="getUserShopAssignments" resultMap="assignmentdata">
    SELECT username, shopid FROM CUCO_USERSHOPASSIGNMENT
  </select>
  
  <insert id="insertUserShopAssignment" parameterClass="assignment">
    INSERT INTO CUCO_USERSHOPASSIGNMENT( username, shopid ) VALUES ( #userName#, #shopID# ) 
  </insert>
  
  <statement id="purgeLogEntries">
    DELETE FROM CUCO_USERSHOPASSIGNMENTLOGS
  </statement>
  
  <statement id="purgeUserShopAssignments">
    DELETE FROM CUCO_USERSHOPASSIGNMENT
  </statement>
  
</sqlMap>
